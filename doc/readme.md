# 天马G游戏筛选器 v1.0

一个用于管理和筛选天马G（Pegasus Frontend）游戏ROM的桌面应用程序。

## 功能特性

### 核心功能

- **项目管理**: 创建、打开和编辑项目
- **双视图模式**: 在来源目录和项目目录之间快速切换
- **任务队列系统**: 先规划操作，统一执行，提高效率
- **游戏预览**: 显示logo、封面图片和预览视频
- **元数据编辑**: 完整的游戏信息编辑功能
- **批量操作**: 根据游戏列表批量添加游戏
- **实时搜索**: 快速过滤和查找游戏
- **日志系统**: 彩色日志显示任务执行情况

### 新增特性

- ✨ **任务队列**: 将添加、删除操作加入队列，统一执行
- ✨ **Logo显示**: 游戏列表显示logo图标
- ✨ **项目设置**: 可修改项目名称和目录
- ✨ **执行日志**: 实时显示任务执行过程
- ✨ **多选功能**: 空格键选择多个游戏
- ✨ **关于窗口**: 显示版本和开发者信息

## 系统要求

- Python 3.7 或更高版本
- Windows / macOS / Linux
- 推荐分辨率：1920x1080 或更高

## 快速开始

### 安装

```bash
# 1. 克隆或下载项目
git clone <repository_url>
cd pegasus-game-filter

# 2. 安装依赖
pip install -r requirements.txt

# 3. 运行程序
python main.py
```

### 第一次使用

1. **创建项目**
   - 点击"文件" -> "新建项目"
   - 输入项目名称
   - 选择来源ROM根目录（包含平台子目录的Roms文件夹）
   - 选择项目ROM根目录（用于存放筛选后的游戏）
   - 保存项目文件

2. **浏览游戏**
   - 在来源目录视图中浏览所有游戏
   - 点击游戏查看详细信息
   - 使用搜索框快速查找

3. **选择游戏**
   - 使用空格键选择游戏（再次按空格取消选择）
   - 选中的游戏会以黄色背景显示
   - 可以选择多个游戏

4. **执行任务**
   - 选择游戏后点击"添加到任务"（或按A键）
   - 任务会被加入队列，状态栏显示任务数量
   - 点击"执行任务"（或按F5键）统一执行
   - 查看日志窗口了解执行情况

## 使用指南

### 天马G目录结构

程序遵循天马G的目录结构规则：

```
Roms/                           # ROM根目录
├── GBA/                        # 平台目录
│   ├── metadata.pegasus.txt   # 元数据文件（必需）
│   ├── media/                 # 媒体目录
│   │   ├── 黄金太阳1/         # 游戏名称目录
│   │   │   ├── logo.png       # Logo图片
│   │   │   ├── boxFront.png   # 封面图片
│   │   │   └── video.mp4      # 视频预览
│   │   └── ...
│   ├── 游戏1.gba
│   ├── 游戏2.zip
│   └── ...
├── GB/                         # 其他平台
└── ...
```

### metadata.pegasus.txt 格式

```
game: 黄金太阳1 开启的封印
file: 黄金太阳1 开启的封印.zip
sort-by: 001
developer: 任天堂
description: 《黄金太阳1 开启的封印》是一款GBA平台的经典RPG游戏...

game: 另一个游戏
file: 另一个游戏.gba
sort-by: 002
developer: 开发商
description: 游戏描述...
```

### 快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| **Tab** | 切换视图 | 在来源目录和项目目录间切换 |
| **Space** | 选择/取消 | 切换当前游戏的选择状态 |
| **↑/↓** | 浏览游戏 | 上一个/下一个游戏 |
| **A** | 添加到任务 | 将选中的游戏加入任务队列 |
| **D** | 删除任务 | 将选中的游戏加入删除队列 |
| **F5** | 执行任务 | 统一执行任务队列中的所有任务 |
| **Ctrl+N** | 新建项目 | 创建新项目 |
| **Ctrl+O** | 打开项目 | 打开已有项目 |
| **Ctrl+S** | 保存项目 | 保存当前项目 |

### 工作流程

#### 流程1：筛选游戏

1. 打开项目
2. 在来源视图中搜索游戏
3. 按空格键选择想要的游戏
4. 按A键添加到任务队列
5. 按F5键执行任务
6. 查看日志确认结果

#### 流程2：批量添加

1. 准备游戏名称列表
2. 点击"批量添加"按钮
3. 粘贴游戏名称（每行一个）
4. 程序自动搜索并添加到任务队列
5. 按F5键执行任务

#### 流程3：删除游戏

1. 按Tab键切换到项目视图
2. 按空格键选择要删除的游戏
3. 按D键添加删除任务
4. 按F5键执行任务

#### 流程4：编辑元数据

1. 选择游戏查看详情
2. 修改游戏信息
3. 点击"保存修改"
4. 按F5键应用更改

## 功能详解

### 任务队列系统

任务队列是本程序的核心特性：

- **延迟执行**: 不立即执行操作，先加入队列
- **批量处理**: 一次性执行多个操作，提高效率
- **可撤销**: 执行前可以清空任务队列
- **日志记录**: 详细记录每个任务的执行情况

任务类型：
- **添加任务**: 从来源目录复制游戏到项目
- **删除任务**: 从项目删除游戏和媒体文件
- **更新任务**: 更新游戏的元数据信息

### 日志窗口

执行任务时会显示日志窗口：

- **绿色**: 成功信息
- **红色**: 错误信息
- **黄色**: 警告信息
- **白色**: 一般信息

### 项目设置

可以修改项目的以下信息：
- 项目名称
- 项目ROM目录
- 来源ROM目录

修改后会自动重新加载游戏列表。

## 错误处理

程序包含完整的错误处理：

- **文件不存在**: 显示清晰的错误提示
- **解析失败**: 记录错误原因
- **执行失败**: 在日志中显示详细错误
- **权限问题**: 提示用户检查权限

## 注意事项

1. **目录结构**: 确保ROM目录符合天马G规则
2. **文件命名**: media目录中的文件必须命名为logo、boxFront、video
3. **元数据文件**: 每个平台目录必须有metadata.pegasus.txt
4. **任务执行**: 任务执行后无法撤销，请谨慎操作
5. **磁盘空间**: 确保有足够的空间复制游戏文件

## 故障排除

### 问题：找不到metadata.pegasus.txt

**解决方案**：
- 确认选择的是Roms根目录（不是平台目录）
- 检查平台目录中是否存在该文件
- 验证文件名拼写是否正确

### 问题：游戏没有logo显示

**解决方案**：
- 检查media/{游戏名称}/logo.png是否存在
- 确认logo文件格式被支持
- 验证文件路径是否正确

### 问题：任务执行失败

**解决方案**：
- 查看日志窗口的详细错误信息
- 检查磁盘空间是否充足
- 确认有目标目录的写入权限
- 验证源文件是否存在

### 问题：程序启动失败

**解决方案**：
- 确认Python版本 >= 3.7
- 重新安装PyQt5: `pip install PyQt5 --force-reinstall`
- 检查是否有其他进程占用

## 开发者信息

- **版本**: 1.0.1
- **开发者**: 王宇
- **技术栈**: Python 3, PyQt5
- **项目文档**:
  - [快速部署与打包](deployment.md)
  - [架构与设计方案](implementation.md)
  - [代码结构说明](structure.md)

## 项目结构

```
pegasus-game-filter/
├── main.py                           # 程序入口
├── requirements.txt                  # 依赖包
├── README.md                         # 本文件
├── IMPLEMENTATION.md                 # 实现文档
├── DEPLOYMENT.md                     # 部署指南
├── core/                             # 核心模块
│   ├── __init__.py
│   ├── project.py                   # 项目管理
│   ├── metadata_parser.py           # 元数据解析
│   ├── game_manager.py              # 游戏管理
│   └── task_system.py               # 任务系统
└── ui/                               # UI模块
    ├── __init__.py
    ├── main_window.py               # 主窗口
    ├── game_list_widget.py          # 游戏列表
    ├── game_detail_widget.py        # 游戏详情
    ├── log_window.py                # 日志窗口
    ├── about_dialog.py              # 关于窗口
    └── project_settings_dialog.py   # 项目设置
```

## 更新日志

### v1.0.0 (2026-01)
- ✅ 实现基本的游戏筛选功能
- ✅ 添加任务队列系统
- ✅ 实现日志窗口
- ✅ 支持logo显示
- ✅ 添加项目设置功能
- ✅ 实现批量操作
- ✅ 完善快捷键支持
- ✅ 添加关于窗口

## 许可证

本项目仅供学习和个人使用。

## 致谢

感谢Pegasus Frontend项目为我们提供了优秀的游戏前端解决方案。
